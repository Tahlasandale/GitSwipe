<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitSwipe - Brutalist.bin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap');
        
        body { font-family: 'Space Mono', monospace; overflow: hidden; background-color: white; color: black; }
        
        .custom-scrollbar::-webkit-scrollbar { width: 10px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: white; border-left: 4px solid black; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: black; border: 2px solid white; }
        
        .markdown-body { 
            font-size: 13px; color: black; line-height: 1.4; 
            overflow-x: hidden !important; width: 100% !important;
        }
        .markdown-body * { 
            max-width: 100% !important; overflow-wrap: break-word !important; word-break: break-word !important;
        }
        .markdown-body h1, .markdown-body h2, .markdown-body h3 { 
            font-weight: 900; text-transform: uppercase; border-bottom: 4px solid #00FF00; display: block; margin: 24px 0 12px; 
        }
        .markdown-body code { 
            background: #00FF00; color: black; padding: 2px 5px; border: 1px solid black; font-weight: bold; white-space: pre-wrap !important; 
        }
        .markdown-body pre { 
            background: black; color: white; padding: 16px; border: 4px solid #00FF00; margin: 16px 0; font-size: 12px; white-space: pre-wrap !important; word-break: break-all !important; 
        }
        .markdown-body img { 
            border: 4px solid black; filter: grayscale(1); margin: 15px 0; max-width: 100% !important; height: auto !important;
        }
        
        .active-card { z-index: 10; transition: transform 0.2s cubic-bezier(0.19, 1, 0.22, 1); will-change: transform; }
        .active-card:active { cursor: grabbing; }

        @keyframes slideIn {
            from { transform: translate(-1000px, 0) rotate(-30deg); opacity: 0; }
            to { transform: translate(0, 0) rotate(0); opacity: 1; }
        }
        .card-undo-anim { animation: slideIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
    </style>
</head>
<body class="flex flex-col h-screen select-none">

    <!-- Header -->
    <header class="bg-black text-white border-b-4 border-black px-4 py-3 flex justify-between items-center z-[60] shrink-0 shadow-[0px_4px_0px_0px_rgba(0,0,0,1)]">
        <div class="flex items-center gap-3">
            <div class="bg-[#00FF00] p-1 border-2 border-white">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="3"><path d="M16 18l6-6-6-6M8 6l-6 6 6 6"/></svg>
            </div>
            <h1 class="font-black text-xl tracking-tighter uppercase italic">GitSwipe.bin</h1>
        </div>
        <nav class="flex gap-2">
            <button id="btn-discover" class="bg-[#00FF00] text-black border-2 border-white px-3 py-1 text-[10px] font-black uppercase shadow-[3px_3px_0px_0px_rgba(255,255,255,1)] translate-x-[-2px] translate-y-[-2px] transition-all">Stream</button>
            <button id="btn-vault" class="hover:bg-white hover:text-black border-2 border-white px-3 py-1 text-[10px] font-black uppercase transition-all">Vault</button>
            <button id="btn-config" class="bg-white text-black border-2 border-white px-2 py-1 hover:bg-[#00FF00] transition-colors">
                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path d="M12 15a3 3 0 100-6 3 3 0 000 6z"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
            </button>
        </nav>
    </header>

    <main class="relative flex-1 flex flex-col items-center p-4 overflow-hidden">
        
        <!-- Discover View -->
        <div id="view-discover" class="w-full h-full flex flex-col items-center">
            <div id="card-container" class="relative w-full max-w-[420px] h-[78vh] mt-2">
                 <div class="flex flex-col items-center justify-center h-full gap-4">
                    <div class="w-12 h-12 border-4 border-black border-t-[#00FF00] animate-spin"></div>
                    <p class="font-black uppercase text-[10px] tracking-widest italic">Handshaking_Github...</p>
                </div>
            </div>

            <div id="feedback" class="hidden absolute top-1/2 -translate-y-1/2 z-50 px-10 py-5 border-4 border-black font-black text-4xl uppercase shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] pointer-events-none"></div>

            <div class="absolute bottom-6 flex items-center gap-6 z-[40]">
                <!-- SKIP -->
                <button onclick="completeSwipe('left')" class="w-14 h-14 bg-white border-4 border-black text-black flex items-center justify-center hover:bg-black hover:text-white shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] active:shadow-none transition-all">
                    <svg width="28" height="28" fill="none" stroke="currentColor" stroke-width="4" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>
                </button>
                <!-- UNDO -->
                <button id="btn-undo" onclick="undoLastSwipe()" class="w-12 h-12 bg-white border-4 border-black text-black flex items-center justify-center hover:bg-[#00FF00] shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] active:shadow-none transition-all opacity-30 cursor-not-allowed">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path d="M3 10h10a8 8 0 0 1 8 8v2M3 10l6 6m-6-6l6-6"/></svg>
                </button>
                <!-- SAVE -->
                <button onclick="completeSwipe('right')" class="w-14 h-14 bg-[#00FF00] border-4 border-black text-black flex items-center justify-center hover:bg-black hover:text-[#00FF00] shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] active:shadow-none transition-all">
                    <svg width="28" height="28" fill="currentColor" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                </button>
            </div>
        </div>

        <!-- Vault / Stars View -->
        <div id="view-vault" class="hidden w-full max-w-2xl overflow-y-auto custom-scrollbar h-full px-2 pt-4">
            <div class="flex justify-between items-end mb-8 border-b-8 border-[#00FF00] px-2 pb-2">
                <h2 id="vault-title" class="text-2xl font-black text-black uppercase italic leading-none">Vault_Storage</h2>
                <span id="vault-loading-indicator" class="hidden text-[10px] font-black uppercase text-black/30 animate-pulse">Refreshing_Database...</span>
            </div>
            <div id="vault-list" class="space-y-4 pb-32"></div>
        </div>
    </main>

    <!-- Config Modal -->
    <div id="config-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center bg-black/90 backdrop-blur-sm p-4">
        <div class="bg-white border-4 border-black p-8 max-w-md w-full shadow-[15px_15px_0px_0px_rgba(0,255,0,1)]">
            <h3 class="font-black text-2xl uppercase mb-4 italic underline decoration-[#00FF00]">System_Config</h3>
            <p class="text-[10px] font-bold mb-6 text-black/60 leading-relaxed uppercase">
                GitHub limite les requêtes (60/h). Collez un <span class="text-black underline">Token GitHub (classic)</span> avec scope 'public_repo' pour starrer en direct.
            </p>
            <input id="gh-token-input" type="password" placeholder="ghp_XXXXXXXXXXXXXXXXXXXX" class="w-full p-4 border-4 border-black mb-6 font-bold text-sm focus:outline-none focus:bg-indigo-50 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]">
            <div class="flex flex-col gap-3">
                <button id="save-token" class="w-full bg-[#00FF00] border-4 border-black py-3 font-black uppercase text-xs shadow-[5px_5px_0px_0px_rgba(0,0,0,1)] active:shadow-none transition-all">Connect_Github</button>
                <button id="clear-token" class="w-full bg-white border-4 border-black py-2 font-black uppercase text-[10px] text-red-600">Disconnect_Account</button>
                <button id="close-modal" class="w-full bg-black text-white py-3 font-black uppercase text-xs">Exit</button>
            </div>
        </div>
    </div>

    <script>
        // --- State ---
        let repos = [];
        let currentIndex = 0;
        let page = 1;
        let isLoading = false;
        let readmeCache = {};
        let fetchingIds = new Set();
        let ghToken = localStorage.getItem('gs_gh_token') || "";
        let localVault = JSON.parse(localStorage.getItem('gs_vault') || "[]");
        let remoteStars = [];
        let swipeHistory = []; 

        // UI Ref
        const cardContainer = document.getElementById('card-container');
        const vaultList = document.getElementById('vault-list');
        const viewDiscover = document.getElementById('view-discover');
        const viewVault = document.getElementById('view-vault');
        const vaultTitle = document.getElementById('vault-title');
        const btnDiscover = document.getElementById('btn-discover');
        const btnVault = document.getElementById('btn-vault');
        const configModal = document.getElementById('config-modal');
        const btnUndo = document.getElementById('btn-undo');
        const vaultRefreshIndicator = document.getElementById('vault-loading-indicator');

        // --- GitHub API ---
        const fetchGithub = async (url, method = 'GET') => {
            const headers = { 'Accept': 'application/vnd.github.html' };
            if (ghToken) headers['Authorization'] = `token ${ghToken}`;
            return await fetch(url, { method, headers });
        };

        const fetchTrendingRepos = async () => {
            if (isLoading) return;
            isLoading = true;
            try {
                const date = new Date();
                date.setMonth(date.getMonth() - 1);
                const dateStr = date.toISOString().split('T')[0];
                const res = await fetchGithub(`https://api.github.com/search/repositories?q=created:>${dateStr}&sort=stars&order=desc&per_page=30&page=${page}`);
                
                if (!res.ok) throw new Error(res.status === 403 ? "LIMIT" : "ERR");
                const data = await res.json();
                
                const starredIds = new Set((ghToken ? remoteStars : localVault).map(r => r.id));
                const filtered = data.items.filter(r => !starredIds.has(r.id));
                
                repos = [...repos, ...filtered];
                renderCurrentCard();
            } catch (err) {
                showToast(err.message === "LIMIT" ? "API LIMIT REACHED" : "CONNECTION ERROR", "bg-red-600");
            } finally {
                isLoading = false;
            }
        };

        const fetchUserStars = async (silent = false) => {
            if (!ghToken) { renderVaultList(localVault); return; }
            if (!silent) vaultRefreshIndicator.classList.remove('hidden');
            try {
                const res = await fetchGithub(`https://api.github.com/user/starred?per_page=100`);
                if (res.ok) {
                    remoteStars = await res.json();
                    renderVaultList(remoteStars);
                }
            } catch (e) { console.error(e); }
            finally { if (!silent) vaultRefreshIndicator.classList.add('hidden'); }
        };

        const toggleStar = async (repo, action = 'star') => {
            if (!ghToken) {
                if (action === 'star') {
                    if (!localVault.find(r => r.id === repo.id)) localVault.unshift(repo);
                } else {
                    localVault = localVault.filter(r => r.id !== repo.id);
                }
                localStorage.setItem('gs_vault', JSON.stringify(localVault));
                renderVaultList(localVault);
                return true;
            }
            try {
                const url = `https://api.github.com/user/starred/${repo.owner.login}/${repo.name}`;
                const res = await fetchGithub(url, action === 'star' ? 'PUT' : 'DELETE');
                if (res.status === 204) { await fetchUserStars(true); return true; }
            } catch (e) { showToast("STAR_SYNC_FAILED", "bg-red-500"); }
            return false;
        };

        const fetchReadme = async (repo) => {
            if (readmeCache[repo.id] || fetchingIds.has(repo.id)) return;
            fetchingIds.add(repo.id);
            try {
                const res = await fetchGithub(`https://api.github.com/repos/${repo.owner.login}/${repo.name}/readme`);
                if (!res.ok) throw new Error();
                const html = await res.text();
                readmeCache[repo.id] = html;
                if (repos[currentIndex] && repos[currentIndex].id === repo.id) {
                    const box = document.getElementById('readme-box');
                    if (box) box.innerHTML = html;
                }
            } catch (e) {
                readmeCache[repo.id] = `<div class="p-10 border-4 border-dashed border-black text-center opacity-30 font-black text-xs">DOCS_NOT_FOUND</div>`;
            } finally { fetchingIds.delete(repo.id); }
        };

        // --- Swipe Logic 2.0 ---
        let startX = 0, startY = 0, currentX = 0, currentY = 0;
        let isDragging = false;
        let swipeIntent = null; 

        const handleStart = (e) => {
            isDragging = true;
            swipeIntent = null;
            startX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            startY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
            currentX = startX;
            currentY = startY;
        };

        const handleMove = (e) => {
            if (!isDragging) return;
            currentX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            currentY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
            
            const dx = currentX - startX;
            const dy = currentY - startY;

            if (!swipeIntent) {
                if (Math.abs(dx) > 10) swipeIntent = 'horizontal';
                else if (Math.abs(dy) > 10) swipeIntent = 'vertical';
            }

            if (swipeIntent === 'horizontal') {
                e.preventDefault(); 
                const card = document.querySelector('.active-card');
                if (card) {
                    card.style.transition = 'none';
                    card.style.transform = `translate(${dx}px, ${dy * 0.05}px) rotate(${dx / 12}deg)`;
                    updateFeedback(dx);
                }
            }
        };

        const handleEnd = () => {
            if (!isDragging) return;
            isDragging = false;
            
            if (swipeIntent === 'horizontal') {
                const dx = currentX - startX;
                if (dx > 75) completeSwipe('right');
                else if (dx < -75) completeSwipe('left');
                else resetCard();
            }
        };

        const completeSwipe = async (dir) => {
            const card = document.querySelector('.active-card');
            if (!card) return;
            
            swipeHistory.push({ index: currentIndex, direction: dir, repo: repos[currentIndex] });
            updateUndoButton();

            card.style.transition = "transform 0.2s ease-in";
            card.style.transform = `translate(${dir === 'right' ? 800 : -800}px, 0) rotate(${dir === 'right' ? 30 : -30}deg)`;
            
            if (dir === 'right') {
                await toggleStar(repos[currentIndex], 'star');
            }

            setTimeout(() => {
                currentIndex++;
                if (currentIndex >= repos.length - 8) { page++; fetchTrendingRepos(); }
                renderCurrentCard();
            }, 120);
        };

        const undoLastSwipe = async () => {
            if (swipeHistory.length === 0) return;
            
            const lastAction = swipeHistory.pop();
            updateUndoButton();
            
            if (lastAction.direction === 'right') {
                await toggleStar(lastAction.repo, 'unstar');
            }
            
            currentIndex = lastAction.index;
            renderCurrentCard(true); 
            showToast("UNDO_ACTION", "bg-black text-white");
        };

        const updateUndoButton = () => {
            if (swipeHistory.length > 0) {
                btnUndo.classList.remove('opacity-30', 'cursor-not-allowed');
                btnUndo.classList.add('opacity-100', 'cursor-pointer');
            } else {
                btnUndo.classList.add('opacity-30', 'cursor-not-allowed');
                btnUndo.classList.remove('opacity-100', 'cursor-pointer');
            }
        };

        const resetCard = () => {
            const card = document.querySelector('.active-card');
            if (card) {
                card.style.transition = "transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)";
                card.style.transform = `translate(0,0) rotate(0)`;
                document.getElementById('feedback').classList.add('hidden');
            }
        };

        const updateFeedback = (dx) => {
            const fb = document.getElementById('feedback');
            if (Math.abs(dx) < 30) { fb.classList.add('hidden'); return; }
            fb.classList.remove('hidden');
            fb.innerText = dx > 0 ? "STAR" : "SKIP";
            fb.className = `absolute top-1/2 -translate-y-1/2 z-50 px-10 py-5 border-4 border-black font-black text-4xl uppercase shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] pointer-events-none ${dx > 0 ? 'right-4 bg-[#00FF00] text-black rotate-6' : 'left-4 bg-black text-white -rotate-6'}`;
        };

        // --- Rendering ---
        const renderCurrentCard = (isUndo = false) => {
            const repo = repos[currentIndex];
            if (!repo) return;
            for(let i=1; i<=3; i++) if(repos[currentIndex+i]) fetchReadme(repos[currentIndex+i]);

            cardContainer.innerHTML = `
                <div class="active-card absolute inset-0 bg-white border-4 border-black shadow-[10px_10px_0px_0px_rgba(0,0,0,1)] flex flex-col overflow-hidden ${isUndo ? 'card-undo-anim' : ''}">
                    <div class="p-4 border-b-4 border-black bg-white flex justify-between items-center shrink-0">
                        <div class="flex items-center gap-3 overflow-hidden">
                            <img src="${repo.owner.avatar_url}" class="w-10 h-10 border-2 border-black" draggable="false">
                            <div class="overflow-hidden leading-none">
                                <p class="text-[9px] font-black uppercase text-black/40 mb-1">${repo.owner.login}</p>
                                <h2 class="font-black text-base uppercase truncate">${repo.name}</h2>
                            </div>
                        </div>
                        <div class="bg-[#00FF00] border-2 border-black px-2 py-1 text-[10px] font-black shrink-0">★ ${repo.stargazers_count}</div>
                    </div>
                    <div class="scrollable-content flex-1 overflow-y-auto overflow-x-hidden p-5 custom-scrollbar bg-white">
                        <div class="p-3 border-2 border-black bg-[#f0f0f0] mb-5 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]">
                            <p class="text-xs font-black uppercase leading-tight italic">"${repo.description || "NO_DESC"}"</p>
                        </div>
                        <div class="flex flex-wrap gap-2 mb-6">
                            <span class="bg-black text-[#00FF00] px-2 py-0.5 text-[9px] font-black uppercase">${repo.language || '??'}</span>
                            <span class="bg-white border-2 border-black px-2 py-0.5 text-[9px] font-black uppercase">V:${new Date(repo.pushed_at).getFullYear()}</span>
                        </div>
                        <div id="readme-box" class="markdown-body border-t-4 border-black pt-6">
                            ${readmeCache[repo.id] || `<div class="py-20 flex flex-col items-center gap-2"><div class="w-8 h-8 border-4 border-black border-t-[#00FF00] animate-spin"></div><span class="text-[9px] font-black uppercase opacity-30 tracking-widest italic">Decrypting_Readme...</span></div>`}
                        </div>
                    </div>
                    <div class="p-4 border-t-4 border-black bg-white shrink-0">
                        <a href="${repo.html_url}" target="_blank" class="w-full block text-center py-3 bg-black text-[#00FF00] border-2 border-black font-black uppercase text-[10px] shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] active:shadow-none translate-y-0 active:translate-y-[4px] active:translate-x-[4px] transition-all">Exec_Github.bin</a>
                    </div>
                </div>
            `;
            if (!readmeCache[repo.id]) fetchReadme(repo);
            document.getElementById('feedback').classList.add('hidden');
        };

        const renderVaultList = (list) => {
            vaultTitle.innerText = ghToken ? "GITHUB_STARS" : "LOCAL_VAULT";
            if (list.length === 0) {
                vaultList.innerHTML = `<div class="p-20 border-4 border-dashed border-black text-center opacity-20 font-black uppercase text-xs italic">Sector_Empty</div>`;
                return;
            }
            vaultList.innerHTML = list.map(f => `
                <div class="bg-white p-4 border-4 border-black shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] flex items-center gap-4 hover:translate-x-1 transition-transform">
                    <img src="${f.owner.avatar_url}" class="w-10 h-10 border-2 border-black shrink-0">
                    <div class="flex-1 overflow-hidden leading-tight">
                        <h4 class="font-black uppercase truncate text-xs">${f.name}</h4>
                        <p class="text-[9px] font-black uppercase opacity-40">★ ${f.stargazers_count}</p>
                    </div>
                    <div class="flex gap-2 shrink-0">
                        <a href="${f.html_url}" target="_blank" class="p-2 border-2 border-black bg-black text-[#00FF00] hover:bg-[#00FF00] hover:text-black transition-colors"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6M15 3h6v6M10 14L21 3"/></svg></a>
                        <button onclick="unstar('${f.owner.login}', '${f.name}', ${f.id})" class="p-2 border-2 border-black hover:bg-red-600 hover:text-white transition-colors"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M10 11v6M14 11v6"/></svg></button>
                    </div>
                </div>
            `).join('');
        };

        window.unstar = async (owner, repoName, id) => {
            const success = await toggleStar({ owner: { login: owner }, name: repoName, id }, 'unstar');
            if (success) showToast("STAR_REMOVED", "bg-black text-white");
        };

        const showToast = (msg, classes) => {
            const toast = document.createElement('div');
            toast.className = `fixed bottom-10 left-1/2 -translate-x-1/2 px-8 py-3 border-4 border-black font-black uppercase text-[10px] z-[200] shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] ${classes}`;
            toast.innerText = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 1500);
        };

        // --- Navigation ---
        btnDiscover.onclick = () => {
            viewDiscover.classList.remove('hidden'); viewVault.classList.add('hidden');
            btnDiscover.classList.add('bg-[#00FF00]', 'text-black', 'shadow-[3px_3px_0px_0px_rgba(255,255,255,1)]', 'translate-x-[-2px]', 'translate-y-[-2px]');
            btnVault.classList.remove('bg-[#00FF00]', 'text-black', 'shadow-[3px_3px_0px_0px_rgba(255,255,255,1)]', 'translate-x-[-2px]', 'translate-y-[-2px]');
        };
        btnVault.onclick = async () => {
            viewVault.classList.remove('hidden'); viewDiscover.classList.add('hidden');
            btnVault.classList.add('bg-[#00FF00]', 'text-black', 'shadow-[3px_3px_0px_0px_rgba(255,255,255,1)]', 'translate-x-[-2px]', 'translate-y-[-2px]');
            btnDiscover.classList.remove('bg-[#00FF00]', 'text-black', 'shadow-[3px_3px_0px_0px_rgba(255,255,255,1)]', 'translate-x-[-2px]', 'translate-y-[-2px]');
            // Rafraîchissement automatique à chaque clic
            await fetchUserStars();
        };

        document.getElementById('btn-config').onclick = () => configModal.classList.remove('hidden');
        document.getElementById('close-modal').onclick = () => configModal.classList.add('hidden');
        document.getElementById('save-token').onclick = () => {
            const val = document.getElementById('gh-token-input').value.trim();
            if (val) {
                ghToken = val;
                localStorage.setItem('gs_gh_token', val);
                showToast("GITHUB_SYNC_ACTIVE", "bg-[#00FF00] text-black");
                configModal.classList.add('hidden');
                repos = []; currentIndex = 0; page = 1; fetchTrendingRepos();
            }
        };
        document.getElementById('clear-token').onclick = () => {
            ghToken = "";
            localStorage.removeItem('gs_gh_token');
            showToast("TOKEN_CLEARED", "bg-black text-white");
            window.location.reload();
        };

        // --- Global Events ---
        window.addEventListener('mousedown', handleStart);
        window.addEventListener('mousemove', handleMove);
        window.addEventListener('mouseup', handleEnd);
        window.addEventListener('touchstart', handleStart, { passive: false });
        window.addEventListener('touchmove', handleMove, { passive: false });
        window.addEventListener('touchend', handleEnd);

        // --- Init ---
        fetchUserStars(true).then(() => fetchTrendingRepos());
    </script>
</body>
</html>
